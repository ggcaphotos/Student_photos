<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Registration</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      max-width: 450px;
      width: 100%;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      overflow: hidden;
      animation: fadeIn 0.6s ease;
    }

    .header {
      background: #2563eb;
      color: #fff;
      padding: 1.5rem;
      text-align: center;
    }

    .header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    .form-content {
      padding: 2rem;
    }

    .form-field {
      margin-bottom: 1.2rem;
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.3rem;
      display: block;
    }

    input[type="text"],
    input[type="tel"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: 0.2s;
    }

    input:focus {
      border-color: #2563eb;
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .image-upload-btn {
      display: inline-block;
      background: #2563eb;
      color: #fff;
      border: none;
      padding: 0.75rem;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    .image-upload-btn:hover {
      background: #1d4ed8;
    }

    .preview-item {
      margin-top: 1rem;
      width: 100%;
      height: 180px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #ddd;
      position: relative;
    }

    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-remove {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255,255,255,0.8);
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      font-weight: bold;
      color: red;
      cursor: pointer;
    }

    button[type="submit"], .btn-primary {
      background: #2563eb;
      border: none;
      color: #fff;
      padding: 0.85rem;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #1d4ed8;
    }

    .thank-you {
      text-align: center;
      padding: 2rem;
    }

    .thank-you-icon {
      font-size: 4rem;
      color: #10b981;
      margin-bottom: 1rem;
    }

    .message {
      margin-top: 1rem;
      font-size: 0.9rem;
      padding: 0.75rem;
      border-radius: 8px;
      text-align: center;
    }

    .message-error {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .message-success {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div class="container" id="formContainer">
    <header class="header">
      <h1>Student Registration</h1>
    </header>
    <div class="form-content">
      <form id="regForm" novalidate>
        <div class="form-field">
          <label for="studentName">Full Name *</label>
          <input id="studentName" name="studentName" type="text" required placeholder="Enter your full name">
        </div>

        <div class="form-field">
          <label for="phoneNumber">Phone Number *</label>
          <input id="phoneNumber" name="phoneNumber" type="tel" required placeholder="Digits only (8–15)">
        </div>

        <div class="form-field">
          <label>Upload Document *</label>
          <button type="button" class="image-upload-btn" id="uploadDocument">Choose & Crop Document</button>
          <input type="file" id="documentInput" accept="image/*" style="display: none;">
          <div class="image-preview" id="documentPreview"></div>
        </div>

        <button type="submit">Submit Registration</button>
        <div id="messageArea"></div>
      </form>
    </div>
  </div>

  <!-- Thank You -->
  <div class="container thank-you" id="thankYouContainer" style="display: none;">
    <div class="thank-you-icon">✓</div>
    <h2>Thank You!</h2>
    <p>Your registration has been submitted successfully.</p>
    <button type="button" class="btn-primary" id="newRegistrationBtn">New Registration</button>
  </div>

  <!-- Crop Modal -->
  <div id="cropModal" class="modal" style="display:none; justify-content:center; align-items:center; background:rgba(0,0,0,0.7); position:fixed; top:0; left:0; width:100%; height:100%;">
    <div class="modal-content" style="background:#fff; padding:1rem; border-radius:12px; max-width:600px; width:90%;">
      <h3>Crop Document</h3>
      <img id="cropImage" style="max-width:100%;">
      <div style="margin-top:1rem; display:flex; justify-content:flex-end; gap:10px;">
        <button type="button" id="cropCancel">Cancel</button>
        <button type="button" class="btn-primary" id="cropConfirm">Crop & Save</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
  <script>
    // ✅ Replace with your deployed Apps Script Web App URL
    const WEB_APP_URL = "PASTE_WEB_APP_URL_HERE";

    let cropper, documentData = null;

    document.getElementById('uploadDocument').addEventListener('click', () => {
      document.getElementById('documentInput').click();
    });
    document.getElementById('documentInput').addEventListener('change', (e) => handleImageUpload(e));

    document.getElementById('cropCancel').addEventListener('click', closeModal);
    document.getElementById('cropConfirm').addEventListener('click', () => {
      const canvas = cropper.getCroppedCanvas({ width: 800, height: 600 });
      canvas.toBlob((blob) => {
        const reader = new FileReader();
        reader.onloadend = () => {
          documentData = reader.result;
          displayImagePreview(documentData);
          closeModal();
        };
        reader.readAsDataURL(blob);
      }, 'image/jpeg', 0.9);
    });

    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        document.getElementById('cropImage').src = event.target.result;
        openModal();
        if (cropper) cropper.destroy();
        cropper = new Cropper(document.getElementById('cropImage'), { aspectRatio: NaN });
      };
      reader.readAsDataURL(file);
    }

    function openModal() { document.getElementById('cropModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('cropModal').style.display = 'none'; if (cropper) { cropper.destroy(); cropper = null; } }

    function displayImagePreview(base64data) {
      const previewContainer = document.getElementById('documentPreview');
      previewContainer.innerHTML = '';
      const previewItem = document.createElement('div');
      previewItem.className = 'preview-item';
      const img = document.createElement('img');
      img.src = base64data;
      const removeBtn = document.createElement('button');
      removeBtn.className = 'preview-remove';
      removeBtn.innerHTML = '×';
      removeBtn.addEventListener('click', () => { documentData = null; previewContainer.innerHTML = ''; });
      previewItem.appendChild(img);
      previewItem.appendChild(removeBtn);
      previewContainer.appendChild(previewItem);
    }

    // Submit
    document.getElementById('regForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('studentName').value.trim();
      const phone = document.getElementById('phoneNumber').value.trim();
      if (!name) { showMessage('Enter your name', true); return; }
      if (!/^[0-9]{8,15}$/.test(phone)) { showMessage('Invalid phone number', true); return; }
      if (!documentData) { showMessage('Please upload a document', true); return; }

      try {
        const fd = new FormData();
        fd.append('studentName', name);
        fd.append('phoneNumber', phone);
        fd.append('documentData', documentData);

        const res = await fetch(WEB_APP_URL, { method: "POST", body: fd });
        const text = await res.text();
        console.log(text);

        document.getElementById('formContainer').style.display = 'none';
        document.getElementById('thankYouContainer').style.display = 'block';
      } catch {
        showMessage('Error submitting form. Try again.', true);
      }
    });

    document.getElementById('newRegistrationBtn').addEventListener('click', () => {
      document.getElementById('regForm').reset();
      document.getElementById('documentPreview').innerHTML = '';
      documentData = null;
      document.getElementById('formContainer').style.display = 'block';
      document.getElementById('thankYouContainer').style.display = 'none';
    });

    function showMessage(msg, error) {
      document.getElementById('messageArea').innerHTML = `<div class="message ${error ? 'message-error' : 'message-success'}">${msg}</div>`;
    }
  </script>
</body>
</html>
